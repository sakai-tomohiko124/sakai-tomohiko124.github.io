<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ“ãƒ³ã‚´ã‚²ãƒ¼ãƒ  - ä¸»å‚¬è€…ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            animation: gradientShift 15s ease infinite;
            background-size: 400% 400%;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
            padding: 1rem;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ */
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: none;
            animation: float 10s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 1.5rem;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: min(1200px, 95vw);
            width: 100%;
            position: relative;
            z-index: 1;
            margin: auto;
            box-sizing: border-box;
        }

        .main-layout {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
            align-items: flex-start;
        }

        .center-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .side-panel {
            width: clamp(150px, 20vw, 200px);
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            padding: 0.8rem;
            max-height: 500px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .side-panel h3 {
            color: #667eea;
            margin-bottom: 0.8rem;
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            position: sticky;
            top: 0;
            background: rgba(102, 126, 234, 0.9);
            backdrop-filter: blur(10px);
            padding: 0.5rem;
            margin: -0.8rem -0.8rem 0.8rem -0.8rem;
            border-radius: 15px 15px 0 0;
            z-index: 10;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .number-item {
            background: white;
            padding: 0.5rem;
            border-radius: 8px;
            font-weight: bold;
            font-size: clamp(1rem, 2vw, 1.3rem);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .number-item.drawn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .number-item.remaining {
            background: white;
            color: #667eea;
        }

        .side-panel::-webkit-scrollbar {
            width: 8px;
        }

        .side-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .side-panel::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .side-panel::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
            }
            
            .side-panel {
                width: 100%;
                max-height: 200px;
            }
            
            .number-grid {
                grid-template-columns: repeat(5, 1fr);
            }

            .replay-btn {
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }

            .mode-selector {
                flex-direction: column;
                gap: 0.5rem;
            }

            .mode-btn {
                width: 100%;
            }

            .number-display {
                font-size: clamp(2.5rem, 15vw, 5rem);
            }

            .reset-btn, .replay-btn {
                display: block;
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        h1 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .mode-selector {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .mode-btn {
            padding: 0.8rem 1.5rem;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .mode-btn.host {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .mode-btn.player {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .mode-btn.active {
            transform: scale(1.05);
        }

        #hostMode, #playerMode {
            display: none;
        }

        .number-display {
            font-size: clamp(3rem, 12vw, 8rem);
            font-weight: bold;
            margin: 1.5rem 0;
            color: #667eea;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
            min-height: clamp(80px, 20vw, 150px);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .draw-btn {
            padding: clamp(1rem, 2vw, 1.5rem) clamp(2rem, 4vw, 3rem);
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
            margin-bottom: 1rem;
        }

        .draw-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(245, 87, 108, 0.6);
        }

        .draw-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .history {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .history h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .history-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .history-number {
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-weight: bold;
            color: #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .bingo-card {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            margin: 2rem 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bingo-cell.free {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .bingo-cell.marked {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(0.95);
        }

        .bingo-cell:hover:not(.marked):not(.free) {
            transform: scale(1.05);
        }

        .reset-btn {
            padding: clamp(0.7rem, 1.5vw, 1rem) clamp(1.2rem, 2.5vw, 2rem);
            font-size: clamp(0.8rem, 1.5vw, 1rem);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-top: 1rem;
        }

        .reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .replay-btn {
            padding: clamp(0.7rem, 1.5vw, 1rem) clamp(1.2rem, 2.5vw, 2rem);
            font-size: clamp(0.8rem, 1.5vw, 1rem);
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-top: 1rem;
            margin-left: 0.5rem;
        }

        .replay-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .replay-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info {
            margin-top: 1rem;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ ãƒ“ãƒ³ã‚´ã‚²ãƒ¼ãƒ  ğŸ‰</h1>
        
        <div class="mode-selector">
            <button class="mode-btn host active" onclick="switchMode('host')">ä¸»å‚¬è€…ç‰ˆ</button>
            <button class="mode-btn player" onclick="switchMode('player')">å‚åŠ è€…ç‰ˆ</button>
        </div>

        <!-- ä¸»å‚¬è€…ç‰ˆ -->
        <div id="hostMode" style="display: block;">
            <div style="margin-bottom: 1.5rem;">
                <label for="maxNumber" style="font-size: 1.1rem; color: #667eea; font-weight: bold; margin-right: 0.5rem;">
                    æœ€å¤§ç•ªå·:
                </label>
                <input type="number" id="maxNumber" min="10" max="100" value="75" 
                       style="padding: 0.5rem 1rem; font-size: 1.1rem; border: 2px solid #667eea; border-radius: 10px; width: 100px; text-align: center;"
                       onchange="updateMaxNumber()">
                <span style="color: #666; font-size: 0.9rem; margin-left: 0.5rem;">(10ï½100)</span>
            </div>

            <div class="main-layout">
                <!-- å·¦å´ï¼šã¾ã å‡ºã¦ãªã„æ•°å­— -->
                <div class="side-panel">
                    <h3>æ®‹ã‚Šç•ªå·</h3>
                    <div class="number-grid" id="remainingNumbers"></div>
                </div>

                <!-- ä¸­å¤®ï¼šãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                <div class="center-content">
                    <div class="number-display" id="currentNumber">-</div>
                    <button class="draw-btn" id="drawBtn" onclick="drawNumber()">ğŸ² å›ã™</button>
                    <div>
                        <button class="reset-btn" onclick="resetGame()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                        <button class="replay-btn" id="replayBtn" onclick="replayDrawnNumbers()" disabled>ğŸ”Š å‡ºãŸæ•°å­—èª­ã¿ä¸Šã’</button>
                    </div>
                    
                    <div class="info" style="margin-top: 1rem;">
                        å‡ºãŸç•ªå·: <span id="drawnCount">0</span>/<span id="maxCount">75</span>
                    </div>
                </div>

                <!-- å³å´ï¼šå‡ºãŸæ•°å­— -->
                <div class="side-panel">
                    <h3>å‡ºãŸç•ªå·</h3>
                    <div class="number-grid" id="drawnNumbersGrid"></div>
                </div>
            </div>

            <div class="info" style="margin-top: 1rem;">
                â€» éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã¯bingo-soundsãƒ•ã‚©ãƒ«ãƒ€ã«1.mp3ï½<span id="maxNumberInfo">75</span>.mp3ã‚’é…ç½®ã—ã¦ãã ã•ã„ï¼ˆãªã‘ã‚Œã°è‡ªå‹•éŸ³å£°èª­ã¿ä¸Šã’ï¼‰
            </div>
        </div>

        <!-- å‚åŠ è€…ç‰ˆ -->
        <div id="playerMode">
            <div style="margin-bottom: 1.5rem;">
                <label for="maxNumberPlayer" style="font-size: 1.1rem; color: #667eea; font-weight: bold; margin-right: 0.5rem;">
                    æœ€å¤§ç•ªå·:
                </label>
                <input type="number" id="maxNumberPlayer" min="10" max="100" value="75" 
                       style="padding: 0.5rem 1rem; font-size: 1.1rem; border: 2px solid #667eea; border-radius: 10px; width: 100px; text-align: center;"
                       onchange="updateMaxNumberPlayer()">
                <span style="color: #666; font-size: 0.9rem; margin-left: 0.5rem;">(10ï½100)</span>
            </div>
            
            <div class="bingo-card" id="bingoCard"></div>
            <button class="draw-btn" onclick="drawNumberPlayer()">ğŸ² å›ã™</button>
            <button class="reset-btn" onclick="generateNewCard()">ğŸ”„ æ–°ã—ã„ã‚«ãƒ¼ãƒ‰</button>
            <div class="number-display" id="currentNumberPlayer" style="font-size: 4rem; min-height: 80px;">-</div>
            
            <div class="info">
                ãƒ“ãƒ³ã‚´ã‚«ãƒ¼ãƒ‰ã®ç•ªå·ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚¯ã§ãã¾ã™
            </div>
        </div>
    </div>

    <script>
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ
        function createParticles() {
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                document.body.appendChild(particle);
            }
        }
        createParticles();

        // ä¸»å‚¬è€…ç‰ˆã®çŠ¶æ…‹
        let maxNumber = 75;
        let drawnNumbers = [];
        let availableNumbers = Array.from({length: 75}, (_, i) => i + 1);

        // å‚åŠ è€…ç‰ˆã®çŠ¶æ…‹
        let maxNumberPlayer = 75;
        let playerCard = [];
        let markedCells = new Set();
        let isReplaying = false; // èª­ã¿ä¸Šã’ä¸­ãƒ•ãƒ©ã‚°

        // éŸ³å£°å†ç”Ÿï¼ˆbingo-soundsãƒ•ã‚©ãƒ«ãƒ€ â†’ Web Speech APIï¼‰
        function playSound(number) {
            const audio = new Audio(`bingo-sounds/${number}.mp3`);
            
            audio.play().catch(err => {
                console.log(`bingo-sounds/${number}.mp3 ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚Web Speech APIã§èª­ã¿ä¸Šã’ã¾ã™ã€‚`);
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å¤±æ•—æ™‚ã¯Web Speech APIã§èª­ã¿ä¸Šã’
                speakNumber(number);
            });
        }

        // Web Speech APIã§æ•°å­—ã‚’èª­ã¿ä¸Šã’
        function speakNumber(number) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(number.toString());
                utterance.lang = 'ja-JP';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                speechSynthesis.speak(utterance);
            } else {
                console.log('éŸ³å£°åˆæˆAPIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }

        // æœ€å¤§ç•ªå·æ›´æ–°ï¼ˆä¸»å‚¬è€…ç‰ˆï¼‰
        function updateMaxNumber() {
            const input = document.getElementById('maxNumber');
            let value = parseInt(input.value);
            
            if (value < 10) value = 10;
            if (value > 100) value = 100;
            
            input.value = value;
            maxNumber = value;
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('maxCount').textContent = maxNumber;
            document.getElementById('maxNumberInfo').textContent = maxNumber;
            
            // ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            drawnNumbers = [];
            availableNumbers = Array.from({length: maxNumber}, (_, i) => i + 1);
            document.getElementById('currentNumber').textContent = '-';
            updateHistory();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸè¡¨ç¤º
        window.addEventListener('DOMContentLoaded', function() {
            updateHistory();
        });

        // æœ€å¤§ç•ªå·æ›´æ–°ï¼ˆå‚åŠ è€…ç‰ˆï¼‰
        function updateMaxNumberPlayer() {
            const input = document.getElementById('maxNumberPlayer');
            let value = parseInt(input.value);
            
            if (value < 10) value = 10;
            if (value > 100) value = 100;
            
            input.value = value;
            maxNumberPlayer = value;
            
            // æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            generateNewCard();
        }

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function switchMode(mode) {
            const hostMode = document.getElementById('hostMode');
            const playerMode = document.getElementById('playerMode');
            const hostBtn = document.querySelector('.mode-btn.host');
            const playerBtn = document.querySelector('.mode-btn.player');

            if (mode === 'host') {
                hostMode.style.display = 'block';
                playerMode.style.display = 'none';
                hostBtn.classList.add('active');
                playerBtn.classList.remove('active');
            } else {
                hostMode.style.display = 'none';
                playerMode.style.display = 'block';
                hostBtn.classList.remove('active');
                playerBtn.classList.add('active');
                if (playerCard.length === 0) {
                    generateNewCard();
                }
            }
        }

        // ä¸»å‚¬è€…ç‰ˆï¼šç•ªå·ã‚’å¼•ã
        function drawNumber() {
            if (availableNumbers.length === 0) {
                alert('å…¨ã¦ã®ç•ªå·ãŒå‡ºã¾ã—ãŸ!');
                return;
            }

            const drawBtn = document.getElementById('drawBtn');
            drawBtn.disabled = true;

            // ãƒ©ãƒ³ãƒ€ãƒ ã«ç•ªå·ã‚’é¸ã¶
            const randomIndex = Math.floor(Math.random() * availableNumbers.length);
            const number = availableNumbers[randomIndex];
            
            // é…åˆ—ã‹ã‚‰å‰Šé™¤
            availableNumbers.splice(randomIndex, 1);
            drawnNumbers.push(number);

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
            const display = document.getElementById('currentNumber');
            let count = 0;
            const interval = setInterval(() => {
                display.textContent = Math.floor(Math.random() * maxNumber) + 1;
                count++;
                if (count > 20) {
                    clearInterval(interval);
                    display.textContent = number;
                    
                    // éŸ³å£°ã‚’å†ç”Ÿ
                    playSound(number);
                    
                    // å±¥æ­´ã‚’æ›´æ–°
                    updateHistory();
                    
                    drawBtn.disabled = false;
                }
            }, 50);
        }

        function updateHistory() {
            const drawnGrid = document.getElementById('drawnNumbersGrid');
            const remainingGrid = document.getElementById('remainingNumbers');
            const countSpan = document.getElementById('drawnCount');
            const replayBtn = document.getElementById('replayBtn');
            
            countSpan.textContent = drawnNumbers.length;
            
            // èª­ã¿ä¸Šã’ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
            if (drawnNumbers.length > 0) {
                replayBtn.disabled = false;
            } else {
                replayBtn.disabled = true;
            }
            
            // å‡ºãŸç•ªå·ã‚’è¡¨ç¤ºï¼ˆæ–°ã—ã„é †ï¼‰
            drawnGrid.innerHTML = '';
            drawnNumbers.slice().reverse().forEach(num => {
                const div = document.createElement('div');
                div.className = 'number-item drawn';
                div.textContent = num;
                drawnGrid.appendChild(div);
            });
            
            // æ®‹ã‚Šã®ç•ªå·ã‚’è¡¨ç¤ºï¼ˆæ˜‡é †ï¼‰
            remainingGrid.innerHTML = '';
            availableNumbers.slice().sort((a, b) => a - b).forEach(num => {
                const div = document.createElement('div');
                div.className = 'number-item remaining';
                div.textContent = num;
                remainingGrid.appendChild(div);
            });
        }

        // å‡ºãŸæ•°å­—ã‚’é †ç•ªã«èª­ã¿ä¸Šã’
        async function replayDrawnNumbers() {
            if (isReplaying || drawnNumbers.length === 0) return;
            
            isReplaying = true;
            const replayBtn = document.getElementById('replayBtn');
            const drawBtn = document.getElementById('drawBtn');
            const display = document.getElementById('currentNumber');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            replayBtn.disabled = true;
            drawBtn.disabled = true;
            replayBtn.textContent = 'ğŸ”Š èª­ã¿ä¸Šã’ä¸­...';
            
            // å‡ºãŸé †ç•ªã«èª­ã¿ä¸Šã’
            for (let i = 0; i < drawnNumbers.length; i++) {
                const number = drawnNumbers[i];
                
                // ç•ªå·ã‚’è¡¨ç¤º
                display.textContent = number;
                display.style.color = '#f5576c';
                
                // éŸ³å£°å†ç”Ÿ
                await playAndWait(number);
                
                // æ¬¡ã®ç•ªå·ã¾ã§å°‘ã—å¾…æ©Ÿ
                if (i < drawnNumbers.length - 1) {
                    await sleep(800);
                }
            }
            
            // å…ƒã«æˆ»ã™
            await sleep(1000);
            display.textContent = drawnNumbers[drawnNumbers.length - 1] || '-';
            display.style.color = '#667eea';
            
            // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            replayBtn.disabled = false;
            drawBtn.disabled = false;
            replayBtn.textContent = 'ğŸ”Š å‡ºãŸæ•°å­—èª­ã¿ä¸Šã’';
            isReplaying = false;
        }

        // éŸ³å£°å†ç”Ÿã‚’å¾…æ©Ÿ
        function playAndWait(number) {
            return new Promise((resolve) => {
                const audio = new Audio(`bingo-sounds/${number}.mp3`);
                
                let resolved = false;
                
                audio.addEventListener('ended', () => {
                    if (!resolved) {
                        resolved = true;
                        resolve();
                    }
                });
                
                audio.addEventListener('error', () => {
                    if (!resolved) {
                        console.log(`bingo-sounds/${number}.mp3 ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚Web Speech APIã§èª­ã¿ä¸Šã’ã¾ã™ã€‚`);
                        resolved = true;
                        speakNumberAndWait(number).then(resolve);
                    }
                });
                
                audio.play().catch(() => {
                    if (!resolved) {
                        resolved = true;
                        speakNumberAndWait(number).then(resolve);
                    }
                });
            });
        }

        // Web Speech APIã§èª­ã¿ä¸Šã’(å¾…æ©Ÿç‰ˆ)
        function speakNumberAndWait(number) {
            return new Promise((resolve) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(number.toString());
                    utterance.lang = 'ja-JP';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    utterance.onend = () => {
                        setTimeout(resolve, 300);
                    };
                    
                    utterance.onerror = () => {
                        setTimeout(resolve, 500);
                    };
                    
                    speechSynthesis.speak(utterance);
                } else {
                    setTimeout(resolve, 500);
                }
            });
        }

        // ã‚¹ãƒªãƒ¼ãƒ—é–¢æ•°
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            if (confirm('ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹?')) {
                drawnNumbers = [];
                availableNumbers = Array.from({length: maxNumber}, (_, i) => i + 1);
                document.getElementById('currentNumber').textContent = '-';
                updateHistory();
            }
        }

        // å‚åŠ è€…ç‰ˆï¼šãƒ“ãƒ³ã‚´ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateNewCard() {
            playerCard = [];
            markedCells.clear();
            
            // 1-maxNumberPlayerã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«25å€‹é¸ã¶ï¼ˆä¸­å¤®ã¯FREEï¼‰
            const numbers = Array.from({length: maxNumberPlayer}, (_, i) => i + 1);
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            
            playerCard = numbers.slice(0, 25);
            playerCard[12] = 'FREE'; // ä¸­å¤®ã‚’FREEã«
            markedCells.add(12); // FREEã¯æœ€åˆã‹ã‚‰ãƒãƒ¼ã‚¯æ¸ˆã¿
            
            renderCard();
        }

        // ã‚«ãƒ¼ãƒ‰æç”»
        function renderCard() {
            const cardDiv = document.getElementById('bingoCard');
            cardDiv.innerHTML = '';
            
            playerCard.forEach((num, index) => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                if (num === 'FREE') {
                    cell.classList.add('free');
                }
                if (markedCells.has(index)) {
                    cell.classList.add('marked');
                }
                cell.textContent = num;
                cell.onclick = () => toggleMark(index);
                cardDiv.appendChild(cell);
            });
        }

        // ã‚»ãƒ«ã®ãƒãƒ¼ã‚¯åˆ‡ã‚Šæ›¿ãˆ
        function toggleMark(index) {
            if (playerCard[index] === 'FREE') return;
            
            if (markedCells.has(index)) {
                markedCells.delete(index);
            } else {
                markedCells.add(index);
            }
            renderCard();
        }

        // å‚åŠ è€…ç‰ˆï¼šç•ªå·ã‚’å¼•ã
        function drawNumberPlayer() {
            const number = Math.floor(Math.random() * maxNumberPlayer) + 1;
            const display = document.getElementById('currentNumberPlayer');
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
            let count = 0;
            const interval = setInterval(() => {
                display.textContent = Math.floor(Math.random() * maxNumberPlayer) + 1;
                count++;
                if (count > 20) {
                    clearInterval(interval);
                    display.textContent = number;
                    
                    // éŸ³å£°ã‚’å†ç”Ÿ
                    playSound(number);
                    
                    // ã‚«ãƒ¼ãƒ‰ã«è©²å½“ã™ã‚‹ç•ªå·ãŒã‚ã‚Œã°å¼·èª¿
                    highlightNumber(number);
                }
            }, 50);
        }

        // è©²å½“ç•ªå·ã‚’ä¸€æ™‚çš„ã«å¼·èª¿
        function highlightNumber(number) {
            const index = playerCard.indexOf(number);
            if (index !== -1 && !markedCells.has(index)) {
                const cells = document.querySelectorAll('.bingo-cell');
                cells[index].style.animation = 'pulse 1s ease 3';
                setTimeout(() => {
                    cells[index].style.animation = '';
                }, 3000);
            }
        }
    </script>
</body>
</html>
