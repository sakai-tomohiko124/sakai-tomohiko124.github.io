<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ±äº¬éƒ½ã®å¤©æ°—äºˆå ±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/responsive-header.css">
    <script src="static/points.js"></script>
    <script src="static/points-header.js"></script>
    <style>
        /* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«ã¨èƒŒæ™¯ --- */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto Mono', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 40%, #1a2980 70%, #00f2fe 100%);
            background-attachment: fixed;
            color: #f2f8ff;
            letter-spacing: 0.03em;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1;
            background: radial-gradient(circle at 80% 10%, #00f2fe55 0%, transparent 60%),
                        radial-gradient(circle at 20% 90%, #ae00ff44 0%, transparent 60%),
                        linear-gradient(120deg, #0f2027cc 0%, #2c5364cc 100%);
            filter: blur(8px) brightness(1.1);
            animation: bgmove 18s linear infinite alternate;
        }
        @keyframes bgmove {
            0% { filter: blur(8px) brightness(1.1); }
            100% { filter: blur(16px) brightness(1.2); }
        }
        
		/* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
		#hamburger-menu-btn {
			display: none;
			position: fixed;
			top: 15px;
			left: 15px;
			z-index: 3000;
			background: linear-gradient(135deg, #00e0ff, #ae00ff);
			border: none;
			border-radius: 8px;
			padding: 12px 15px;
			font-size: 1.5em;
			color: #fff;
			cursor: pointer;
			box-shadow: 0 4px 10px rgba(0, 224, 255, 0.4);
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}
		#hamburger-menu-btn:hover {
			transform: scale(1.05);
			box-shadow: 0 6px 15px rgba(0, 224, 255, 0.6);
		}

		/* PCç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
		.responsive-nav {
			display: none;
			background: rgba(20,30,60,0.8);
			backdrop-filter: blur(2px);
			color: #fff;
			padding: 0.7em 0;
			text-align: center;
			font-size: 1.1em;
			letter-spacing: 1px;
			position: sticky;
			top: 0;
			z-index: 100;
		}
		.responsive-nav a {
			color: #00e0ff;
			margin: 0 1em;
			text-decoration: underline;
		}

		/* ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
		#table-of-contents {
			position: fixed;
			top: 0;
			left: 0;
			width: 280px;
			height: 100vh;
			background: rgba(20, 30, 60, 0.95);
			backdrop-filter: blur(10px);
			color: #f2f8ff;
			padding: 20px;
			box-shadow: 4px 0 20px rgba(0, 224, 255, 0.3);
			z-index: 2000;
			overflow-y: auto;
			transform: translateX(-100%);
			transition: transform 0.3s ease;
		}
		#table-of-contents.open {
			transform: translateX(0);
		}
		#table-of-contents h2 {
			color: #00e0ff;
			text-shadow: 0 0 8px rgba(0, 224, 255, 0.8);
			margin-top: 0;
		}
		#table-of-contents ul {
			list-style: none;
			padding: 0;
			margin: 0;
		}
		#table-of-contents li {
			margin: 0.8em 0;
		}
		#table-of-contents a {
			color: #f2f8ff;
			text-decoration: none;
			font-size: 1.05em;
			transition: color 0.3s ease, text-shadow 0.3s ease;
		}
		#table-of-contents a:hover {
			color: #00e0ff;
			text-shadow: 0 0 8px rgba(0, 224, 255, 0.8);
		}

		/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
		@media (max-width: 768px) {
			#hamburger-menu-btn {
				display: block;
			}
			.responsive-nav {
				display: none !important;
			}
		}
		@media (min-width: 769px) {
			.responsive-nav {
				display: block;
			}
			#table-of-contents {
				display: none;
			}
		}

        /* --- ã‚³ãƒ³ãƒ†ãƒŠ --- */
        .container {
            max-width: 900px;
            margin: 40px auto;
            background: rgba(20,30,60,0.92);
            padding: 24px 36px;
            border-radius: 18px;
            box-shadow: 0 0 32px #00f2fe44, 0 2px 24px #ae00ff22;
            backdrop-filter: blur(2px);
        }
        .header { text-align: center; border-bottom: 1px solid #00f2fe33; padding-bottom: 15px; margin-bottom: 20px; }
        h1 { margin: 0; color: #f2f8ff; text-shadow: 0 0 8px #00f2fe99; }
        .meta-info { font-size: 0.9em; color: #a0b0c0; margin-top: 10px; }
        
        /* --- 3æ—¥é–“äºˆå ± --- */
        .forecast-container { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; }
        .forecast-card {
            flex: 1;
            min-width: 250px;
            border: 1px solid #00f2fe33;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            background-color: rgba(0,242,254,0.08);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .forecast-card.current-date { background-color: rgba(0,242,254,0.2); border-color: #00f2fe88; }
        .forecast-card h2 { margin: 0 0 15px 0; font-size: 1.4em; color: #00f2fe; text-shadow: 0 0 8px #00f2fe99; }
        .weather { font-weight: bold; font-size: 1.2em; margin-bottom: 15px; }
        .temps { font-size: 1.1em; margin-bottom: 15px; }
        .temp-max { color: #ff8a80; font-weight: bold; }
        .temp-min { color: #82b1ff; font-weight: bold; }
        .rain-chance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px 10px; font-size: 0.9em; margin-top: 10px; }
        .rain-chance-grid div { text-align: center; }
        .rain-chance-label { color: #a0b0c0; padding: 2px 4px; border-radius: 4px; transition: background-color 0.3s, color 0.3s; }
        .rain-chance-label.current-hour-highlight { background-color: #e8f5e9; font-weight: bold; color: #2e7d32; }

        /* --- 1æ™‚é–“ã”ã¨äºˆå ± --- */
        .hourly-section { margin-top: 40px; }
        .hourly-section h3 { text-align: center; color: #00f2fe; text-shadow: 0 0 8px #00f2fe99; border-bottom: 1px solid #00f2fe33; padding-bottom: 10px; margin-bottom: 20px; }
        .hourly-forecast-container { display: flex; overflow-x: auto; padding: 10px 0 15px 0; border-radius: 8px; background: rgba(0,0,0,0.2); }
        .hourly-card { flex: 0 0 80px; padding: 10px; border-right: 1px solid #00f2fe22; text-align: center; font-size: 0.9em; transition: background-color 0.3s; }
        .hourly-card.current-hour-highlight { background-color: rgba(130, 177, 255, 0.2); }
        .hourly-card:last-child { border-right: none; }
        .hourly-time { font-weight: bold; }
        .hourly-weather { font-size: 0.85em; height: 3em; display: flex; align-items: center; justify-content: center; }
        .hourly-temp { font-size: 1.1em; font-weight: bold; margin: 5px 0; }
        .hourly-precip { font-size: 0.85em; color: #82b1ff; }
        .hourly-date-separator { flex: 0 0 100px; font-weight: bold; color: #00f2fe; display: flex; align-items: center; justify-content: center; border-right: 1px solid #00f2fe33; background-color: rgba(0, 242, 254, 0.1); }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ */
        .message-box { text-align: center; color: #a0b0c0; padding: 30px; border: 1px dashed #00f2fe55; border-radius: 8px; background-color: transparent; }
        .message-box.error { color: #ff8a80; border-color: #ff8a80; }

        @media (max-width: 600px) {
            .container { padding: 6vw 2vw; border-radius: 0; margin: 0; }
            .nav a { margin: 0 0.5em; font-size: 0.9em; }
        }
        
        #hamburger-menu-btn {
            display: block !important;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 9999;
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            cursor: pointer;
            padding: 0;
            transition: all 0.3s ease;
        }
        
        /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®3æœ¬ç·š */
        #hamburger-menu-btn::before,
        #hamburger-menu-btn::after,
        .hamburger-line {
            content: '';
            display: block;
            width: 32px;
            height: 4px;
            background: #00e0ff;
            border-radius: 2px;
            margin: 0 auto 6px;
            box-shadow: 0 0 10px rgba(0, 224, 255, 0.8), 0 0 20px rgba(0, 224, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        #hamburger-menu-btn::before {
            margin-top: 8px;
        }
        
        #hamburger-menu-btn::after {
            margin-bottom: 0;
        }
        
        #hamburger-menu-btn:hover::before,
        #hamburger-menu-btn:hover::after,
        #hamburger-menu-btn:hover .hamburger-line {
            background: #ff00ff;
            box-shadow: 0 0 15px rgba(255, 0, 255, 1), 0 0 30px rgba(255, 0, 255, 0.7);
            transform: scaleX(1.1);
        }
    </style>
</head>
<body>
	<button id="hamburger-menu-btn">
		<span class="hamburger-line"></span>
	</button>
	<nav class="responsive-nav">
		<a href="home.html">ãƒ›ãƒ¼ãƒ </a>
		<a href="index2.html">ã‚¯ã‚¤ã‚º</a>
		<a href="index5.html">ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</a>
		<a href="ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ.html" style="font-weight: bold;" target="_blank">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç”»é¢ã¸</a>
	</nav>
	    <aside id="table-of-contents">
        <h2>å…¨ãƒªãƒ³ã‚¯é›†</h2>
        <ul>
            <li><a href="home.html">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
            <li><a href="index2.html">ğŸ§  ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¯ã‚¤ã‚º</a></li>
            <li><a href="index5.html">ğŸ“– ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</a></li>
            <li><a href="ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ.html">ğŸ“Š ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç”»é¢ã¸</a></li>
            <li><a href="logout.html">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
            <li><a href="link.html">ğŸ“‘ å…¨ãƒªãƒ³ã‚¯é›†</a></li>
            <li><a href="hate.html">ğŸ¯ è‹¦æ‰‹å…‹æœ</a></li>
            <li><a href="hate/base.html">ğŸ“š ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªç”¨èªé›†</a></li>
            <li><a href="https://docs.python.org/ja/3/" target="_blank">ğŸ Pythonå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
            <li><a href="https://www.w3schools.com/sql/" target="_blank">ğŸ—„ï¸ SQLãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a></li>
            <li><a href="pythonexam.html">ğŸ“ Pythonè©¦é¨“æƒ…å ±</a></li>
            <li><a href="æ„Ÿæƒ³.html">âœï¸ Pythonèªå®šåŸºç¤è©¦é¨“ã®æ„Ÿæƒ³</a></li>
            <li><a href="https://www.rakuten.co.jp/kbsanhe/" target="_blank">ğŸ›’ æ¥½å¤©ã‚µã‚¤ãƒˆ</a></li>
            <li><a href="weather.html">ğŸŒ¤ï¸ å¤©æ°—æƒ…å ±</a></li>
            <li><a href="train.html">ğŸšƒ é›»è»Šæƒ…å ±</a></li>
            <li><a href="other.html">ğŸ”— ãã®ä»–</a></li>
            <li><a href="index3.html">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</a></li>
            <li><a href="index4.html">ğŸ”— ä¾¿åˆ©ãƒªãƒ³ã‚¯</a></li>
            <li><a href="story.html">ğŸ“– ç‰©èª</a></li>
            <li><a href="list_mobile/index.html">ğŸ“± è¦‹ã‚‹ã‚‚ã®ãƒªã‚¹ãƒˆ</a></li>
        </ul>
    </aside>

    <div class="container">
        <div class="header">
            <h1>æ±äº¬éƒ½ã®å¤©æ°—äºˆå ±</h1>
            <div class="meta-info">
                <span id="publishing-office"></span> ç™ºè¡¨: <span id="report-time"></span>
            </div>
        </div>
        
        <div id="forecast-container" class="forecast-container">
            <div class="message-box" style="width: 100%;"><p>3æ—¥é–“äºˆå ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p></div>
        </div>

        <div class="hourly-section">
            <h3>æ™‚é–“ã”ã¨ã®äºˆå ±ï¼ˆ72æ™‚é–“ï¼‰</h3>
            <div id="hourly-forecast-container" class="hourly-forecast-container">
                <div class="message-box" style="width: 100%;"><p>1æ™‚é–“ã”ã¨äºˆå ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p></div>
            </div>
        </div>
    </div>

    <script>
        const UPDATE_INTERVAL_MS = 30 * 60 * 1000;
        
        const forecastContainer = document.getElementById('forecast-container');
        const hourlyContainer = document.getElementById('hourly-forecast-container');
        const publishingOfficeElem = document.getElementById('publishing-office');
        const reportTimeElem = document.getElementById('report-time');

        function renderDailyForecast(forecasts) {
            forecastContainer.innerHTML = '';
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            const currentHour = now.getHours();

            forecasts.slice(0, 3).forEach((forecast, index) => {
                const card = document.createElement('div');
                card.className = 'forecast-card';
                if (forecast.date === todayStr) {
                    card.classList.add('current-date');
                }

                let dateLabel = new Date(forecast.date).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                if (index === 0) dateLabel += " (ä»Šæ—¥)";
                if (index === 1) dateLabel += " (æ˜æ—¥)";
                
                let rainGridHTML = '<div class="rain-chance-grid">';
                const timeSlots = [
                    { label: "0-6æ™‚", endHour: 6, value: forecast.chance_of_rain[0] },
                    { label: "6-12æ™‚", endHour: 12, value: forecast.chance_of_rain[1] },
                    { label: "12-18æ™‚", endHour: 18, value: forecast.chance_of_rain[2] },
                    { label: "18-24æ™‚", endHour: 24, value: forecast.chance_of_rain[3] }
                ];

                let currentSlotFound = false;
                timeSlots.forEach(slot => {
                    let labelClass = 'rain-chance-label';
                    
                    if (forecast.date === todayStr) {
                        if (currentHour >= slot.endHour) {
                            return;
                        }
                        if (!currentSlotFound && currentHour < slot.endHour) {
                            labelClass += ' current-hour-highlight';
                            currentSlotFound = true;
                        }
                    }
                    
                    rainGridHTML += `
                        <div class="${labelClass}">${slot.label}</div>
                        <div>${slot.value}%</div>
                    `;
                });
                rainGridHTML += '</div>';

                card.innerHTML = `
                    <h2>${dateLabel}</h2>
                    <div class="weather">${forecast.weather}</div>
                    <div class="temps">
                        <span class="temp-max">${forecast.temp_max}Â°C</span> / <span class="temp-min">${forecast.temp_min}Â°C</span>
                    </div>
                    <strong>é™æ°´ç¢ºç‡</strong>
                    ${rainGridHTML}
                `;
                forecastContainer.appendChild(card);
            });
        }

        function renderHourlyForecast(hourlyForecasts) {
            hourlyContainer.innerHTML = '';
            const now = new Date();
            
            const upcomingHourly = hourlyForecasts.filter(hour => new Date(hour.iso_time) >= now);

            let lastDate = null;
            upcomingHourly.forEach((hour, index) => {
                const hourDateObj = new Date(hour.iso_time);
                const hourDateStr = hourDateObj.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });

                if (hourDateStr !== lastDate) {
                    const dateSeparator = document.createElement('div');
                    dateSeparator.className = 'hourly-date-separator';
                    dateSeparator.textContent = hourDateStr;
                    hourlyContainer.appendChild(dateSeparator);
                    lastDate = hourDateStr;
                }

                const card = document.createElement('div');
                card.className = 'hourly-card';
                
                if (index === 0) {
                    card.classList.add('current-hour-highlight');
                }

                card.innerHTML = `
                    <div class="hourly-time">${hour.time}</div>
                    <div class="hourly-weather">${hour.weather}</div>
                    <div class="hourly-temp">${hour.temp}Â°C</div>
                    <div class="hourly-precip">${hour.precip}mm</div>
                `;
                hourlyContainer.appendChild(card);
            });
        }

        async function fetchAndUpdateWeather() {
            try {
                const response = await fetch('weather_info.json?t=' + new Date().getTime());
                if (!response.ok) throw new Error(`ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼ (HTTP ${response.status})`);
                
                const data = await response.json();
                if (data.error) throw new Error(data.error);

                publishingOfficeElem.textContent = data.publishingOffice;
                reportTimeElem.textContent = new Date(data.reportDatetime).toLocaleString('ja-JP');
                
                renderDailyForecast(data.forecasts);
                renderHourlyForecast(data.hourly_forecast);

            } catch (error) {
                const errorMessage = `<div class="message-box error" style="width: 100%;"><p><strong>å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</strong></p><p><small>${error.message}</small></p></div>`;
                forecastContainer.innerHTML = errorMessage;
                hourlyContainer.innerHTML = errorMessage;
            }
        }

        fetchAndUpdateWeather();
        setInterval(fetchAndUpdateWeather, UPDATE_INTERVAL_MS);
    </script>
	<script>
		// LocalStorageã®å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—(6æ™‚é–“ä»¥ä¸ŠçµŒéã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤)
		function cleanupOldWeatherData() {
			try {
				const DATA_RETENTION_HOURS = 6;
				const lastCheck = localStorage.getItem('lastWeatherCheck');
				
				if (lastCheck) {
					const checkDate = new Date(lastCheck);
					const now = new Date();
					const hoursDiff = (now - checkDate) / (1000 * 60 * 60);
					
					if (hoursDiff > DATA_RETENTION_HOURS) {
						localStorage.removeItem('lastWeatherCheck');
						console.log(`å¤ã„å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ (${hoursDiff.toFixed(1)}æ™‚é–“çµŒé)`);
					}
				}
			} catch (error) {
				console.error('ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
			}
		}
		
		// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
		cleanupOldWeatherData();
		
		// ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ©Ÿèƒ½
		document.addEventListener('DOMContentLoaded', () => {
			const hamburgerButton = document.getElementById('hamburger-menu-btn');
			const toc = document.getElementById('table-of-contents');

			if (hamburgerButton && toc) {
				hamburgerButton.addEventListener('click', e => {
					e.stopPropagation();
					toc.classList.toggle('open');
				});
				document.body.addEventListener('click', e => {
					if (toc.classList.contains('open') && !toc.contains(e.target) && e.target !== hamburgerButton) {
						toc.classList.remove('open');
					}
				});
			}

			// å¤©æ°—æƒ…å ±ç¢ºèªãƒã‚¤ãƒ³ãƒˆä»˜ä¸ï¼ˆ1æ—¥1å›ï¼‰
			if (typeof pointsManager !== 'undefined') {
				const today = new Date().toDateString();
				const lastWeatherCheck = localStorage.getItem('lastWeatherCheck');
				
				if (lastWeatherCheck !== today) {
					setTimeout(() => {
						pointsManager.onWeatherCheck();
						localStorage.setItem('lastWeatherCheck', today);
					}, 5000); // 5ç§’é–“ãƒšãƒ¼ã‚¸ã«æ»åœ¨ã§ãƒã‚¤ãƒ³ãƒˆä»˜ä¸
				}
			}
		});
	</script>
    <script src="static/security.js"></script>
</body>
</html>
